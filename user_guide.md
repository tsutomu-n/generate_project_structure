
# `generate_project_structure.sh` ユーザーガイド

このガイドでは、`generate_project_structure.sh` スクリプトの使用方法について詳しく説明します。

## 1. スクリプトの概要

`generate_project_structure.sh` は、Git リポジトリのファイル構造を Markdown 形式で出力するための Bash スクリプトです。このスクリプトを使用することで、プロジェクトのファイル構造を簡単に把握し、ドキュメント化することができます。

## 2. 必要なもの

*   Bash シェルが実行できる環境 (Linux, macOS, Windows Subsystem for Linux (WSL), Git Bash など)
*   Git がインストールされていること
*   `tree` コマンド (オプション。インストールされていなくても動作しますが、出力形式が変わります)
*   `sort`、`mktemp`コマンド(通常、Unix/Linux システムに標準でインストールされています)

## 3. スクリプトの配置

1.  `generate_project_structure.sh` ファイルを、ファイル構造を出力したい Git リポジトリのルートディレクトリに配置します。
2.  または、`.scripts` のような名前のサブディレクトリを作成し、その中にスクリプトを配置しても構いません。

## 4. 実行権限の付与

ターミナルを開き、スクリプトを配置したディレクトリに移動します。

```bash
# リポジトリのルートディレクトリに配置した場合
chmod +x generate_project_structure.sh

# .scripts サブディレクトリに配置した場合
chmod +x .scripts/generate_project_structure.sh
```

## 5. スクリプトの実行

```bash
# リポジトリのルートディレクトリに配置した場合
./generate_project_structure.sh

# .scripts サブディレクトリに配置した場合
./.scripts/generate_project_structure.sh
```

スクリプトを実行すると、`.cursor/rules/structure.mdc` というファイルがプロジェクトのルートディレクトリに作成 (または上書き) され、その中に Markdown 形式でファイル構造が出力されます。

## 6. 出力例

`.cursor/rules/structure.mdc` ファイルを開くと、以下のような内容が出力されています。

```
# Project Structure

​```
.
├── README.md
├── src
│   ├── main.py
│   └── utils.py
└── tests
    └── test_main.py
​```
```

*   `tree` コマンドがインストールされている場合は、より詳細なツリー形式で出力されます。
*   `tree` コマンドがない場合は、Bash スクリプトによる簡易的なツリー形式で出力されます。

## 7. スクリプトの仕組み (詳細)

このスクリプトは、以下の手順で動作します。

1.  **環境判定:** 実行環境が Windows (PowerShell または WSL) か Unix/Linux かを判定し、パス区切り文字などを環境に合わせて設定します。
2.  **出力ファイルの準備:** `.cursor/rules/structure.mdc` ファイルを作成 (または上書き) し、Markdown のヘッダーとコードブロックの開始記号を書き込みます。
3.  **`tree` コマンドの有無チェック:** `tree` コマンドがインストールされているかどうかを確認します。
4.  **ファイル構造の取得と書き込み:**
    *   `tree` コマンドが利用可能な場合:
        *   `git ls-files` コマンドで Git リポジトリ内のファイルリストを取得します。
        *   `tree --fromfile -a` コマンドにファイルリストを渡し、ツリー形式の出力を生成します。
        *   生成された出力を `.cursor/rules/structure.mdc` ファイルに書き込みます。
    *   `tree` コマンドが利用できない場合:
        *   Bash スクリプトでファイル構造を解析します。
        *   `git ls-files` コマンドでファイルリストを取得します。
        *   各ファイルのパスを解析し、階層レベルを計算します。
        *   インデントや接続線 (│, ├──, └──) を付加して、簡易的なツリー形式の文字列を生成します。
        *   生成された文字列を `.cursor/rules/structure.mdc` ファイルに書き込みます。
5.  **後処理:** Markdown のコードブロックの終了記号を `.cursor/rules/structure.mdc` ファイルに書き込み、一時ファイルを削除します。

## 8. トラブルシューティング

*   **スクリプトが実行できない:**
    *   スクリプトに実行権限が付与されているか確認してください (`chmod +x ...`)。
    *   Bash シェルがインストールされているか確認してください。
*   **ファイル構造が出力されない:**
    *   Git リポジトリのルートディレクトリでスクリプトを実行しているか確認してください。
    *   `.cursor/rules` ディレクトリが存在し、書き込み権限があるか確認してください。
*   **エラーメッセージが表示される:**
    *   エラーメッセージの内容を確認し、必要なコマンド (Git など) がインストールされているか、パスが正しいかなどを確認してください。

## 9. その他の情報
*   このスクリプトは、`#!/usr/bin/env bash` を使用しているため、多くの環境で動作するはずです。
*   スクリプト内でエラーが発生した場合は、エラーメッセージを表示して終了します。
